<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controle de Atendimento</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 2.2em;
        }
        
        .datetime {
            color: #7f8c8d;
            font-size: 1.1em;
        }
        
        .form-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            cursor: pointer;
        }
        
        .section-title {
            font-size: 1.5em;
            color: #2c3e50;
            font-weight: 600;
        }
        
        .toggle-btn {
            background: #3498db;
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .form-content {
            transition: all 0.3s ease;
        }
        
        .form-content.hidden {
            display: none;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        input, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #3498db;
        }
        
        .days-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .day-section {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .day-header-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            cursor: pointer;
            background: #f8f9fa;
        }
        
        .day-title {
            font-size: 1.2em;
            font-weight: 700;
            color: #2c3e50;
        }
        
        .day-toggle-btn {
            background: #3498db;
            color: white;
            border: none;
            border-radius: 50%;
            width: 28px;
            height: 28px;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .day-content {
            padding: 20px;
            display: none;
        }
        
        .day-content.active {
            display: block;
        }
        
        .time-slots {
            display: grid;
            gap: 15px;
        }
        
        .time-slot {
            display: grid;
            grid-template-columns: 40px auto 120px 120px 100px 1fr;
            gap: 10px;
            align-items: center;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .slot-number {
            font-weight: bold;
            text-align: center;
            color: #2c3e50;
            font-size: 1.1em;
        }
        
        .time-input {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .time-input label {
            font-size: 0.8em;
            font-weight: 500;
        }
        
        .time-input input[type="time"] {
            width: 120px;
            padding: 8px;
        }
        
        .time-input input[type="text"] {
            width: 100px;
            padding: 8px;
        }
        
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .summary-item {
            text-align: center;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
            border: 2px solid #3498db;
        }
        
        .summary-item h3 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .summary-item p {
            font-size: 1.3em;
            font-weight: 700;
            color: #3498db;
        }
        
        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-primary {
            background: #3498db;
            color: white;
        }
        
        .btn-primary:hover {
            background: #2980b9;
        }
        
        .btn-danger {
            background: #e74c3c;
            color: white;
        }
        
        .btn-danger:hover {
            background: #c0392b;
        }
        
        .btn-success {
            background: #27ae60;
            color: white;
        }
        
        .btn-success:hover {
            background: #219653;
        }
        
        .hidden {
            display: none !important;
        }
        
        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .time-slot {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .slot-number {
                grid-column: 1 / -1;
                text-align: left;
            }
            
            .time-input input[type="time"],
            .time-input input[type="text"] {
                width: 100%;
                padding: 12px;
            }
            
            h1 {
                font-size: 1.8em;
            }
            
            .day-header-section {
                padding: 15px;
            }
            
            .day-content {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Controle de Atendimento</h1>
            <div class="datetime" id="currentDateTime"></div>
        </header>

        <!-- Cadastro de Profissional/Paciente -->
        <div class="form-section">
            <div class="section-header" onclick="toggleSection('cadastro')">
                <h2 class="section-title">Cadastro de Profissional e Paciente</h2>
                <button class="toggle-btn" id="toggle-cadastro">+</button>
            </div>
            <div class="form-content hidden" id="cadastro-content">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="profissional">Profissional</label>
                        <input type="text" id="profissional" placeholder="Digite o nome do profissional">
                    </div>
                    <div class="form-group">
                        <label for="paciente">Paciente</label>
                        <input type="text" id="paciente" placeholder="Digite o nome do paciente">
                    </div>
                    <div class="form-group">
                        <label for="responsavel">Responsável</label>
                        <input type="text" id="responsavel" placeholder="Digite o nome do responsável">
                    </div>
                </div>
                <button class="btn-primary" onclick="saveCadastro()">Salvar Cadastro</button>
            </div>
        </div>

        <!-- Dias do Mês -->
        <div class="form-section">
            <div class="section-header" onclick="toggleSection('dias')">
                <h2 class="section-title">Atendimentos por Dia</h2>
                <button class="toggle-btn" id="toggle-dias">+</button>
            </div>
            <div class="form-content hidden" id="dias-content">
                <div class="days-container" id="daysContainer"></div>
            </div>
        </div>

        <!-- Resumo do Mês -->
        <div class="form-section">
            <div class="section-header" onclick="toggleSection('resumo')">
                <h2 class="section-title">Resumo de Atendimento do Mês</h2>
                <button class="toggle-btn" id="toggle-resumo">+</button>
            </div>
            <div class="form-content hidden" id="resumo-content">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="resumoPaciente">Selecione o Paciente</label>
                        <select id="resumoPaciente" onchange="calculateSummary()">
                            <option value="">Selecione um paciente</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="valorHora">Valor da hora (R$)</label>
                        <input type="number" id="valorHora" placeholder="0.00" step="0.01" onchange="calculateSummary()">
                    </div>
                </div>
                <div class="summary-grid hidden" id="summaryResults">
                    <div class="summary-item">
                        <h3>Paciente</h3>
                        <p id="summaryPaciente"></p>
                    </div>
                    <div class="summary-item">
                        <h3>Atendimentos</h3>
                        <p id="summaryAtendimentos">0</p>
                    </div>
                    <div class="summary-item">
                        <h3>Total de Horas</h3>
                        <p id="summaryHoras">0h 0m</p>
                    </div>
                    <div class="summary-item">
                        <h3>Valor a Receber</h3>
                        <p id="summaryValor">R$ 0,00</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Gerenciar Cadastros -->
        <div class="form-section">
            <div class="section-header" onclick="toggleSection('gerenciar')">
                <h2 class="section-title">Gerenciar Cadastros</h2>
                <button class="toggle-btn" id="toggle-gerenciar">+</button>
            </div>
            <div class="form-content hidden" id="gerenciar-content">
                <div class="form-group">
                    <label for="selecionarCadastro">Selecione um Cadastro</label>
                    <select id="selecionarCadastro" onchange="showCadastroDetails()">
                        <option value="">Selecione um cadastro</option>
                    </select>
                </div>
                <div id="cadastroDetails" class="hidden">
                    <div class="form-grid" id="cadastroDetailsContent"></div>
                    <div class="btn-group">
                        <button class="btn-success" onclick="editCadastro()">Editar</button>
                        <button class="btn-danger" onclick="deleteCadastro()">Excluir</button>
                    </div>
                </div>
                <div id="editForm" class="hidden">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="editProfissional">Profissional</label>
                            <input type="text" id="editProfissional" placeholder="Digite o nome do profissional">
                        </div>
                        <div class="form-group">
                            <label for="editPaciente">Paciente</label>
                            <input type="text" id="editPaciente" placeholder="Digite o nome do paciente">
                        </div>
                        <div class="form-group">
                            <label for="editResponsavel">Responsável</label>
                            <input type="text" id="editResponsavel" placeholder="Digite o nome do responsável">
                        </div>
                    </div>
                    <div class="btn-group">
                        <button class="btn-primary" onclick="saveEditCadastro()">Salvar Edição</button>
                        <button class="btn-danger" onclick="cancelEdit()">Cancelar</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Data in memory
        let cadastros = [];
        let currentEditId = null;
        let currentDate = new Date();
        let currentYear = currentDate.getFullYear();
        let currentMonth = currentDate.getMonth();

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            updateDateTime();
            setInterval(updateDateTime, 1000);
            generateDays();
            loadCadastros();
            updateCadastroSelect();
            loadDayData();
        });

        function updateDateTime() {
            const now = new Date();
            const options = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            };
            document.getElementById('currentDateTime').textContent = now.toLocaleDateString('pt-BR', options);
        }

        function toggleSection(sectionId) {
            const content = document.getElementById(`${sectionId}-content`);
            const button = document.getElementById(`toggle-${sectionId}`);
            
            if (content.classList.contains('hidden')) {
                content.classList.remove('hidden');
                button.textContent = '-';
            } else {
                content.classList.add('hidden');
                button.textContent = '+';
            }
        }

        function toggleDay(day) {
            const content = document.getElementById(`day-content-${day}`);
            const button = document.getElementById(`toggle-day-${day}`);
            
            if (content.classList.contains('active')) {
                content.classList.remove('active');
                button.textContent = '+';
            } else {
                content.classList.add('active');
                button.textContent = '-';
            }
        }

        function saveCadastro() {
            const profissional = document.getElementById('profissional').value.trim();
            const paciente = document.getElementById('paciente').value.trim();
            const responsavel = document.getElementById('responsavel').value.trim();
            
            if (!profissional || !paciente) {
                alert('Por favor, preencha o nome do profissional e do paciente.');
                return;
            }
            
            const id = Date.now();
            cadastros.push({ id, profissional, paciente, responsavel });
            
            try {
                localStorage.setItem('cadastros', JSON.stringify(cadastros));
            } catch (e) {
                console.warn('LocalStorage não disponível, usando memória apenas');
            }
            
            updateCadastroSelect();
            clearCadastroForm();
            updatePacienteOptions();
            updatePacienteOptionsInSlots();
        }

        function clearCadastroForm() {
            document.getElementById('profissional').value = '';
            document.getElementById('paciente').value = '';
            document.getElementById('responsavel').value = '';
            document.getElementById('profissional').focus();
        }

        function updateCadastroSelect() {
            const select = document.getElementById('selecionarCadastro');
            select.innerHTML = '<option value="">Selecione um cadastro</option>';
            
            cadastros.forEach(cadastro => {
                const option = document.createElement('option');
                option.value = cadastro.id;
                option.textContent = `${cadastro.paciente} - ${cadastro.profissional}`;
                select.appendChild(option);
            });
        }

        function showCadastroDetails() {
            const id = document.getElementById('selecionarCadastro').value;
            if (!id) {
                document.getElementById('cadastroDetails').classList.add('hidden');
                document.getElementById('editForm').classList.add('hidden');
                return;
            }
            
            const cadastro = cadastros.find(c => c.id == id);
            if (cadastro) {
                document.getElementById('cadastroDetails').classList.remove('hidden');
                const content = document.getElementById('cadastroDetailsContent');
                content.innerHTML = `
                    <div class="form-group">
                        <label>Profissional</label>
                        <p>${cadastro.profissional}</p>
                    </div>
                    <div class="form-group">
                        <label>Paciente</label>
                        <p>${cadastro.paciente}</p>
                    </div>
                    <div class="form-group">
                        <label>Responsável</label>
                        <p>${cadastro.responsavel}</p>
                    </div>
                `;
                currentEditId = parseInt(id);
            }
        }

        function editCadastro() {
            if (currentEditId === null) {
                alert('Nenhum cadastro selecionado para edição.');
                return;
            }
            
            const cadastro = cadastros.find(c => c.id === currentEditId);
            if (cadastro) {
                document.getElementById('editProfissional').value = cadastro.profissional;
                document.getElementById('editPaciente').value = cadastro.paciente;
                document.getElementById('editResponsavel').value = cadastro.responsavel;
                
                document.getElementById('cadastroDetails').classList.add('hidden');
                document.getElementById('editForm').classList.remove('hidden');
            }
        }

        function saveEditCadastro() {
            const profissional = document.getElementById('editProfissional').value.trim();
            const paciente = document.getElementById('editPaciente').value.trim();
            const responsavel = document.getElementById('editResponsavel').value.trim();
            
            if (!profissional || !paciente) {
                alert('Por favor, preencha o nome do profissional e do paciente.');
                return;
            }
            
            const index = cadastros.findIndex(c => c.id === currentEditId);
            if (index !== -1) {
                cadastros[index] = { id: currentEditId, profissional, paciente, responsavel };
                
                try {
                    localStorage.setItem('cadastros', JSON.stringify(cadastros));
                } catch (e) {
                    console.warn('LocalStorage não disponível');
                }
                
                updateCadastroSelect();
                document.getElementById('editForm').classList.add('hidden');
                document.getElementById('selecionarCadastro').value = '';
                document.getElementById('cadastroDetails').classList.add('hidden');
                currentEditId = null;
                updatePacienteOptions();
                updatePacienteOptionsInSlots();
            }
        }

        function cancelEdit() {
            document.getElementById('editForm').classList.add('hidden');
            document.getElementById('cadastroDetails').classList.remove('hidden');
        }

        function deleteCadastro() {
            if (currentEditId === null) {
                alert('Nenhum cadastro selecionado para exclusão.');
                return;
            }
            
            if (confirm('Tem certeza que deseja excluir este cadastro?')) {
                cadastros = cadastros.filter(c => c.id !== currentEditId);
                try {
                    localStorage.setItem('cadastros', JSON.stringify(cadastros));
                } catch (e) {
                    console.warn('LocalStorage não disponível');
                }
                updateCadastroSelect();
                document.getElementById('cadastroDetails').classList.add('hidden');
                document.getElementById('editForm').classList.add('hidden');
                document.getElementById('selecionarCadastro').value = '';
                currentEditId = null;
                updatePacienteOptions();
                updatePacienteOptionsInSlots();
            }
        }

        function loadCadastros() {
            try {
                const saved = localStorage.getItem('cadastros');
                if (saved) {
                    cadastros = JSON.parse(saved);
                }
            } catch (e) {
                console.warn('LocalStorage não disponível, começando com cadastros vazios');
            }
        }

        function generateDays() {
            const container = document.getElementById('daysContainer');
            container.innerHTML = '';
            
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
            
            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(currentYear, currentMonth, day);
                const dayOfWeek = date.getDay();
                const isWeekend = dayOfWeek === 0 || dayOfWeek === 6;
                const isHoliday = checkHoliday(date);
                
                const daySection = document.createElement('div');
                daySection.className = 'day-section';
                if (isWeekend) {
                    daySection.style.backgroundColor = '#e3f2fd';
                }
                if (isHoliday) {
                    daySection.style.backgroundColor = '#fff3e0';
                }
                
                const dayName = ['Domingo', 'Segunda', 'Terça', 'Quarta', 'Quinta', 'Sexta', 'Sábado'][dayOfWeek];
                const monthName = ['Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho', 'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'][currentMonth];
                
                daySection.innerHTML = `
                    <div class="day-header-section" onclick="toggleDay(${day})">
                        <div class="day-title">${dayName}, ${day} de ${monthName}</div>
                        <button class="day-toggle-btn" id="toggle-day-${day}">+</button>
                    </div>
                    <div class="day-content" id="day-content-${day}">
                        <div class="time-slots" id="slots-${day}"></div>
                    </div>
                `;
                
                const slotsContainer = daySection.querySelector(`#slots-${day}`);
                for (let slot = 1; slot <= 10; slot++) {
                    const slotDiv = document.createElement('div');
                    slotDiv.className = 'time-slot';
                    slotDiv.innerHTML = `
                        <div class="slot-number">${slot}</div>
                        <div class="form-group" style="display: flex; align-items: center; justify-content: center;">
                            <input type="checkbox" id="confirm-${day}-${slot}" onchange="saveDayData(${day}, ${slot})">
                        </div>
                        <div class="time-input">
                            <label for="start-${day}-${slot}">Início</label>
                            <input type="time" id="start-${day}-${slot}" onchange="calculateDuration(${day}, ${slot})">
                        </div>
                        <div class="time-input">
                            <label for="end-${day}-${slot}">Término</label>
                            <input type="time" id="end-${day}-${slot}" onchange="calculateDuration(${day}, ${slot})">
                        </div>
                        <div class="time-input">
                            <label for="duration-${day}-${slot}">Duração</label>
                            <input type="text" id="duration-${day}-${slot}" readonly>
                        </div>
                        <div class="form-group">
                            <label for="patient-${day}-${slot}">Paciente</label>
                            <select id="patient-${day}-${slot}" onchange="saveDayData(${day}, ${slot})">
                                <option value="">Selecione paciente</option>
                            </select>
                        </div>
                    `;
                    slotsContainer.appendChild(slotDiv);
                }
                
                container.appendChild(daySection);
            }
            
            // Atualizar opções de paciente em todos os slots
            updatePacienteOptionsInSlots();
        }

        function checkHoliday(date) {
            // Feriados fixos do Brasil (simplificado)
            const month = date.getMonth() + 1;
            const day = date.getDate();
            
            const holidays = [
                { month: 1, day: 1 },   // Ano Novo
                { month: 4, day: 21 },  // Tiradentes
                { month: 5, day: 1 },   // Dia do Trabalho
                { month: 9, day: 7 },   // Independência
                { month: 10, day: 12 }, // Nossa Senhora
                { month: 11, day: 2 },  // Finados
                { month: 11, day: 15 }, // Proclamação
                { month: 12, day: 25 }  // Natal
            ];
            
            return holidays.some(holiday => holiday.month === month && holiday.day === day);
        }

        function calculateDuration(day, slot) {
            const startInput = document.getElementById(`start-${day}-${slot}`);
            const endInput = document.getElementById(`end-${day}-${slot}`);
            const durationInput = document.getElementById(`duration-${day}-${slot}`);
            
            if (startInput.value && endInput.value) {
                const start = parseTime(startInput.value);
                const end = parseTime(endInput.value);
                
                if (end >= start) {
                    const diff = end - start;
                    const hours = Math.floor(diff / 60);
                    const minutes = diff % 60;
                    durationInput.value = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;
                } else {
                    durationInput.value = '';
                }
            } else {
                durationInput.value = '';
            }
            
            saveDayData(day, slot);
        }

        function parseTime(timeString) {
            const [hours, minutes] = timeString.split(':').map(Number);
            return hours * 60 + minutes;
        }

        function updatePacienteOptions() {
            const select = document.getElementById('resumoPaciente');
            const currentSelection = select.value;
            select.innerHTML = '<option value="">Selecione um paciente</option>';
            
            const pacientes = [...new Set(cadastros.map(c => c.paciente))];
            pacientes.forEach(paciente => {
                const option = document.createElement('option');
                option.value = paciente;
                option.textContent = paciente;
                select.appendChild(option);
            });
            
            select.value = currentSelection;
        }

        function updatePacienteOptionsInSlots() {
            const pacientes = [...new Set(cadastros.map(c => c.paciente))];
            
            // Atualizar todos os selects de paciente nos slots
            document.querySelectorAll('select[id^="patient-"]').forEach(select => {
                const currentSelection = select.value;
                select.innerHTML = '<option value="">Selecione paciente</option>';
                pacientes.forEach(paciente => {
                    const option = document.createElement('option');
                    option.value = paciente;
                    option.textContent = paciente;
                    select.appendChild(option);
                });
                select.value = currentSelection;
            });
        }

        function calculateSummary() {
            const paciente = document.getElementById('resumoPaciente').value;
            const valorHora = parseFloat(document.getElementById('valorHora').value) || 0;
            
            if (!paciente || valorHora <= 0) {
                document.getElementById('summaryResults').classList.add('hidden');
                return;
            }
            
            let totalAtendimentos = 0;
            let totalMinutes = 0;
            
            // Verificar todos os slots de todos os dias
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
            for (let day = 1; day <= daysInMonth; day++) {
                for (let slot = 1; slot <= 10; slot++) {
                    const confirmCheckbox = document.getElementById(`confirm-${day}-${slot}`);
                    const patientSelect = document.getElementById(`patient-${day}-${slot}`);
                    const durationInput = document.getElementById(`duration-${day}-${slot}`);
                    
                    if (confirmCheckbox && confirmCheckbox.checked && 
                        patientSelect && patientSelect.value === paciente && 
                        durationInput && durationInput.value) {
                        
                        totalAtendimentos++;
                        const [hours, minutes] = durationInput.value.split(':').map(Number);
                        totalMinutes += hours * 60 + minutes;
                    }
                }
            }
            
            const totalHoras = Math.floor(totalMinutes / 60);
            const totalMinutos = totalMinutes % 60;
            const valorTotal = (totalMinutes / 60) * valorHora;
            
            document.getElementById('summaryPaciente').textContent = paciente;
            document.getElementById('summaryAtendimentos').textContent = totalAtendimentos;
            document.getElementById('summaryHoras').textContent = `${totalHoras}h ${totalMinutos}m`;
            document.getElementById('summaryValor').textContent = `R$ ${valorTotal.toFixed(2).replace('.', ',')}`;
            document.getElementById('summaryResults').classList.remove('hidden');
        }

        // Day data persistence
        function saveDayData(day, slot) {
            try {
                const storageKey = `dayData_${currentYear}_${currentMonth}`;
                let dayData = JSON.parse(localStorage.getItem(storageKey) || '{}');
                
                const slotData = {
                    confirmed: document.getElementById(`confirm-${day}-${slot}`).checked,
                    startTime: document.getElementById(`start-${day}-${slot}`).value,
                    endTime: document.getElementById(`end-${day}-${slot}`).value,
                    duration: document.getElementById(`duration-${day}-${slot}`).value,
                    patient: document.getElementById(`patient-${day}-${slot}`).value
                };
                
                if (!dayData[day]) {
                    dayData[day] = {};
                }
                dayData[day][slot] = slotData;
                
                localStorage.setItem(storageKey, JSON.stringify(dayData));
            } catch (e) {
                console.warn('Não foi possível salvar os dados do dia');
            }
        }
        
        function loadDayData() {
            try {
                const storageKey = `dayData_${currentYear}_${currentMonth}`;
                const dayData = JSON.parse(localStorage.getItem(storageKey) || '{}');
                
                const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
                for (let day = 1; day <= daysInMonth; day++) {
                    for (let slot = 1; slot <= 10; slot++) {
                        if (dayData[day] && dayData[day][slot]) {
                            const data = dayData[day][slot];
                            document.getElementById(`confirm-${day}-${slot}`).checked = data.confirmed || false;
                            document.getElementById(`start-${day}-${slot}`).value = data.startTime || '';
                            document.getElementById(`end-${day}-${slot}`).value = data.endTime || '';
                            document.getElementById(`duration-${day}-${slot}`).value = data.duration || '';
                            document.getElementById(`patient-${day}-${slot}`).value = data.patient || '';
                        }
                    }
                }
            } catch (e) {
                console.warn('Não foi possível carregar os dados do dia');
            }
        }
    </script>
</body>
</html>

